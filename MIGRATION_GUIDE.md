# Руководство по миграции: Новая структура с подкатегориями

## Обзор изменений

Приложение теперь использует новую структуру с подкатегориями:
- **Экран 1**: Выбор категории (кластера)
- **Экран 2**: Выбор подкатегории (Слова, Короткие предложения, Длинные предложения)
- **Экран 3**: Проигрывание фраз/слов

## Шаги миграции

### 1. Добавить поле `phrase_type` в таблицу `phrases`

Выполните SQL скрипт в Supabase SQL Editor:

```sql
-- Файл: database/add-phrase-type-migration.sql
```

Этот скрипт:
- Добавляет колонку `phrase_type` с типами: `word`, `short_sentence`, `long_sentence`
- Устанавливает все существующие фразы в тип `long_sentence`
- Добавляет индексы для производительности

### 2. Удалить категорию "Beginner"

Выполните SQL скрипт в Supabase SQL Editor:

```sql
-- Файл: database/delete-beginner-cluster.sql
```

Этот скрипт:
- Удаляет все фразы из категории "Beginner"
- Удаляет саму категорию "Beginner"

### 3. Обновить существующие фразы

Все существующие фразы автоматически получат тип `long_sentence` при выполнении первого скрипта.

### 4. Добавить новые фразы типа "word" и "short_sentence"

После миграции вы можете добавлять новые фразы с типами:
- `word` - отдельные слова
- `short_sentence` - короткие предложения
- `long_sentence` - длинные предложения (по умолчанию)

## Структура данных

### Таблица `phrases`

Новое поле:
- `phrase_type` VARCHAR(20) - тип фразы: `word`, `short_sentence`, `long_sentence`

### Типы фраз

1. **word** - отдельное слово
   - `portuguese_text` - слово на португальском
   - `ipa_transcription` - транскрипция слова
   - `translation` (в таблице translations) - предложение с использованием слова
   - Требуется отдельный перевод слова (можно добавить позже)

2. **short_sentence** - короткое предложение
   - Структура как у обычных фраз

3. **long_sentence** - длинное предложение
   - Структура как у обычных фраз (все существующие фразы)

## Навигация

### Старый путь (поддерживается для обратной совместимости):
```
/clusters → /phrases?clusters=id1,id2 → /player?phraseId=...&clusters=...
```

### Новый путь:
```
/clusters → /subcategories?cluster=id&name=... → /player?cluster=id&phraseType=word
```

## Важные замечания

1. **Обратная совместимость**: Старый путь через `/phrases?clusters=...` все еще работает
2. **Категория "Beginner"**: Полностью удалена из системы
3. **Все существующие фразы**: Автоматически получают тип `long_sentence`
4. **Новые фразы**: Можно добавлять с любым типом через админ-панель или SQL

## Проверка миграции

После выполнения миграции проверьте:

1. Категория "Beginner" не отображается на экране выбора категорий
2. При выборе категории открывается экран подкатегорий
3. Все существующие фразы имеют тип `long_sentence`
4. Страница проигрывания корректно отображает разные типы карточек

## Откат изменений

Если нужно откатить изменения:

```sql
-- Удалить поле phrase_type
ALTER TABLE phrases DROP COLUMN IF EXISTS phrase_type;

-- Восстановить категорию Beginner (если нужно)
-- (требуется восстановление из бэкапа)
```








